an electrode system to capture bioelectric signals from a subject generally should address various requirements including safety needs , cost , power consumption , performance , ease of use and subject comfort . however , the relative importance of these factors may be somewhat different in a non - clinical application than in a clinical application . in particular , in a non - clinical application , the electrodes are more likely to be applied by a person with no training or knowledge of correct application or placement of the electrodes . in addition , the user may be attempting to apply the electrodes to himself or herself . consequently , it is more likely that the electrodes will not be properly placed , both in terms of location and necessary contact pressure or contact area on the subject &# 39 ; s skin , e . g . the scalp in the case of eeg . as a result , signal noise becomes more likely , and the analysis of the signals from the electrodes becomes more prone to error . in general , the lack of training or knowledge of the user can be alleviated by providing a system that automatically determines whether signal - quality for individual electrodes is satisfactory , and displays this information to the user . thus , the display effective acts as a feedback mechanism to inform the inexperienced user of incorrect positioning of the electrodes . the user can then reposition or adjust the pressure on the electrodes indicated as being improperly placed until an acceptable level of contact to the user &# 39 ; s scalp is achieved . if the contact quality deteriorates over time , as the headset is being used , the user can be informed that a particular electrode needs readjustment . for example , dry sensors might perform worse as the skin dries out , whereas wet sensors might lose conductivity as the electrolyte in the contact material is depleted . by alerting the user of changes in the contact quality , the user can take corrective action . in addition , information regarding the contact quality can be directed to an automated mechanism for compensating for a deteriorating signal . for example , in the case of a wet sensor , the system might include automatic control for replenishing the conductive solution that is triggered as the contact quality deteriorates . turning now to fig1 , there is shown a system for detecting and classifying mental states and facial expressions ( collectively simply referred to as “ states ”) of a subject and generating signals to represent these states . in general , the system can detect both non - deliberative mental states , for example emotions , e . g ., excitement , happiness , fear , sadness , boredom , and other emotions , and deliberative mental states , e . g ., a mental command to push , pull or manipulate an object in a real or virtual environment . the system is capable of detection of mental states ( both deliberative and non - deliberative ) and facial expressions using solely electrical signals , particularly eeg signals , from the subject , and without direct measurement of other physiological processes , such as heart rate , blood pressure , respiration or galvanic skin response , as would be obtained by a heart rate monitor , blood pressure monitor , and the like . signals from the system representing the state of the user are directed to an application 152 . the application 152 can also respond to input events by modifying an environment , e . g ., a real environment or a virtual environment as displayed on a display 154 . thus , the mental state or facial expressions of a user can be used as a control input for a gaming system , or another application ( including a simulator or other interactive environment ). the system includes two main components , a neuro - physiological signal acquisition device 102 , e . g ., an electrode headset , that is worn or otherwise carried by a subject , and a state detection engine 114 . in brief , the neuro - physiological signal acquisition device 102 detects bio - signals from the subject , and the state detection engine 114 implements one or more detection algorithms that convert these bio - signals into signals representing the presence ( and optionally intensity ) of particular states in the subject . in addition , an automated signal quality detection process 40 detects the quality of the bio - signals from the signal acquisition device 102 , and user interface software 42 can display indicia of the signal quality to the user . as a headset , the neuro - physiological signal acquisition device 102 includes multiple electrodes 103 which , when the headset is properly placed on the subject &# 39 ; s head , electrically contact the subject &# 39 ; s scalp at predetermined locations to measure eeg signals . it should be noted , however , that the eeg signals measured and used by the system 10 can include signals outside the frequency range , e . g ., 0 . 3 - 80 hz , that is customarily recorded for eeg . moreover , the system 10 can utilize even higher frequencies , e . g ., above 100 hz , for determination of the sensor contact quality . unlike systems that provide high - resolution 3 - d brain scans , e . g ., mri or cat scans , the headset is generally portable and non - constraining . referring to fig2 , one implementation of an electrode headset 102 is shown . the electrode headset 102 is configured to fit snugly on a subject &# 39 ; s head . the headset 102 includes multiple electrode mounts , each configured to mount an electrode . in this implementation the electrode mounts are apertures 130 configured to receive and mount an electrode , e . g ., by a press fit ( the electrodes themselves are not illustrated in fig2 so as to more clearly illustrate the apertures 130 ). however , it should be noted that other configurations of electrode mounts can be used . for example , an electrode can be mounted to the electrode headset using a clamp , screw or other suitable connection mechanism and / or configuration . in general , the headset 102 can be sufficiently flexible to fit comfortably on the subject &# 39 ; s head , but sufficiently rigid to hold the electrodes 103 in approximately the correct positions on the scalp . returning to fig1 , a headset assembly 100 includes the headset 102 itself , the electrodes 103 , and additional circuitry for transmitting the signals from the headset to the state detection engine 114 . the signals detected by each of the electrodes 103 on the headset 102 are fed through a sensory interface 104 , which can include an amplifier to boost signal strength and a filter to remove noise , and then digitized by an analog - to - digital converters 106 . digitized samples of the signal captured by each of the scalp sensors can be stored in a data buffer 108 . the data buffer 108 is connected to the signal quality detection circuitry 40 . the data buffer is connected , e . g ., through an input / output transmission device 110 , such as a wireless 2 . 4 ghz device , a wifi or bluetooth device , to a processing system 120 that runs the state detection engine 114 . a microcontroller 109 controls communication between the memory 108 and the input / output device , and handles other aspects of the headset assembly 100 , such as controlling power to components to conserve battery lifetime . in particular , the microcontroller 109 can respond to queries regarding signal quality from the user interface 42 or other components of the processing system 120 by accessing the signal quality detection circuitry 40 , and returning the signal quality data . the processing system 120 can include a digital signal processor ( dsp ) 112 , to perform desired functional steps of the state detection engine . in general , the dsp 112 performs preprocessing of the digital signals to reduce noise , transforms the signal to “ unfold ” it from the particular shape of the subject &# 39 ; s cortex , and performs the emotion , deliberative mental state and facial expression detection algorithms on the transformed signal . although illustrated as part of a dsp , the state detection engine can be implemented primarily in hardware using , for example , hardware components such as an application specific integrated circuit ( asic ), as software , for example , as a memory including a series of instructions to be performed by a dsp or general purpose computer , or using a combination of both software and hardware . systems for detecting mental states are described in u . s . patent publication no . 2007 - 0173733 and u . s . patent publication no . 2007 - 0066914 , both of which are incorporated by reference . systems for detecting facial expressions are described in u . s . patent publication no . 2007 - 0179396 , which is incorporated by reference . the processing system 120 can include the user interface software 42 to display the indicia of the signal quality to the user on the display 154 . in the illustrated implementation , the head set assembly 100 includes the head set 102 , interface 104 and a / d converter ( s ) 106 , mux / data buffer 108 , microcontroller 109 , wireless transmission device 110 , and signal quality detection circuitry 40 , as well as a battery for power supply . in addition , in the illustrated implementation , application 152 and the dsp 112 are part of the same external device 150 , e . g ., a general purpose computer or a game console . however , many other configurations are possible . the state detection engine 114 can be in a dedicated processor unit that is separate from the platform 150 running the application 152 . in this case , the processor unit can includes the wireless receiver to receive data from the headset assembly . the processor unit can be connected to the platform 150 by a wired or wireless connection , such as a cable that connects to a usb input of the platform 150 . the state detection engine 114 can be software running on the same processor as the application 152 . various components , can be moved onto or off the headset assembly . for example , the signal quality detection circuitry 40 could be part of a unit separate from the platform 150 running the ( e . g ., the same unit with the state detection engine 114 ), or be integrated into the platform 140 . the buffer 108 could be eliminated or replaced by a multiplexer ( mux ), and the data stored directly in the memory of the processing system . a mux could be placed before the a / d converter stage so that only a single a / d converter is needed . the connection between the head set assembly 100 and the platform 150 can be wired rather than wireless . as noted above , an automated signal quality detection process 40 detects the quality of the bio - signals from the signal acquisition device 102 , and the user interface software 42 displays indicia of the quality on a display 154 . referring to fig3 a , in a first implementation , when the headset is placed on the user &# 39 ; s head , the user can initiate or the system can auto - initiate a signal quality feedback mode . the signal from each electrode is measured ( step 202 ), and a state of contact is calculated for each electrode from one or more properties of the signal ( step 204 ). the state of contact for each electrode can be determined using threshold based classifier system using factors such as amplitude , frequency and transient information of the signal of that electrode . such a threshold based classifier system can calculate a weighted sum of the amplitude , frequency and transient information of the signal , and compare the weighted sum to a predetermined threshold ( s ). if the weighted sum is outside the accepted threshold ( s ), this indicates an un - acceptable state of contact . the state of contact for each electrode is then displayed to the user on a graphical interface , e . g ., a monitor 154 ( step 206 ). it is also possible to have multiple thresholds that provide a range of contact quality states . the range of contact quality states can show intermediate levels of contact that might prompt some kind of action by the user , e . g ., replacing or re - hydrating the sensor contact material as it is drying out , in case of conductive felt tip based sensor . there are potential problems with this approach . if the characteristics of the hardware acquisition system , sensors or other parts in the signal chain are changed , then the algorithm used by the threshold based classifier system might need to be retuned . in addition , there are large variations in skin impedances between individuals , making this threshold based approach less reliable across a population . the threshold based implementation can also introduce significant processing latencies that can be evident to the user as fixed delays in graphical representation of signal quality . for example , if a particular sensor becomes mechanically offset or the noise increases , the threshold based implementation may have a lag before this information is displayed to the user . finally , this technique is sensitive to facial expression or muscle artifacts , which might falsely trigger signal quality algorithms . referring to fig3 b , in a second implementation , a low current , low voltage , reference signal is injected into the user , i . e ., applied to one of the electrodes ( step 212 ). the current of the reference signal can be limited to 10 microamperes or less to meet fda standards and to make sure there is no discomfort to the user . this reference signal can be a regular waveform , e . g ., a square wave or sine wave , with a frequency outside the standard eeg frequency range , but within the range detected by the acquisition system . for example , the reference signal can have a frequency greater than 100 hz , e . g ., more than 200 hz . however , some implementations can utilize a reference signal that is inside of the eeg band . in some implementations , the reference signal is combined with a biasing signal and injected into the user through a driven right leg ( drl ) electrode on the headset 102 . the drl electrode can be one of the biosensor electrodes 103 . a potential advantage of the described implementation is that it uses existing circuitry , and does not require an accurate measurement of the contact impedance . alternative implementations can use an injection electrode separate from the biosensor electrodes 103 . in some implementations , scalp impedance can be detected . in this case a constant current source circuit can be used to generate the injected signal . the injected reference signal is effectively combined with eeg signals and other artifacts in the scalp , before its picked up by the eeg sensors . each eeg sensor will pick up a signal that is a linear combination of the injected reference , eeg , muscle artifacts and noise . the amplitude and phase of the input reference signal will be modified by the scalp tissue . the amplitude of the injected signal will be attenuated at various stages along the path from the drl electrode to the sensor electrode . the injecting and sensing electrodes , the electrode / scalp interface and the scalp tissue all play a part in the reference signal attenuation . the attenuation will become larger as the distance between the injection point and the sensing site increases . the major attenuation will happen at the sensor / scalp interface as the impedance of this site is the most significant in the chain . for this reason the system is relatively unaffected by absolute positioning of the injection electrode . as described above , signals that are detected at various scalp locations will contain eeg data , artifacts , noise and injected reference signal components . as the frequency and phase characteristics of the injected reference signal are known , information about the amplitude of the reference signal component contained inside of the detected signal can be computed . this amplitude can then be compared to the amplitude of the reference signal before it was injected and thus the contact quality can be computed . the reference signal can be a substantially spurious - free waveform , such as a clean sine wave . such a waveform can add negligible harmonic distortion and can allow for simple filtering and removal after signal quality is determined . in general , however , any waveform of known amplitude and frequency can be used . it is possible to use other regular waveforms such as square waves , triangle waves , etc ., that have different spectral characteristics , as long as care is taken not to inject unwanted harmonics into the eeg band of interest . in some implementations the reference signal is a square wave , as a square wave can be more easily generated in digital hardware . the reference signal can be generated inside of a microcontroller and its amplitude level adjusted through a fixed value resistor divider or an amplifier with a digitally controllable gain . more complex waveforms can be generated using analog oscillators , phase locked loops , or direct digital synthesis ( dds ). in one implementation of circuitry 50 for generating a reference signal is shown in fig5 . a precursor s 1 to the reference signal is generated inside of microcontroller 54 ( which can be the microcontroller 109 ). in this implementation the reference signal is a synchronized square wave at 273 hz . this square wave is attenuated through an attenuator circuit 54 , such as resistor divider , down to 100 uv . optionally , the attenuator circuit 54 can be digitally controlled by a signal rc from the microprocessor 52 . the signal is then buffered , e . g ., by an op - amp buffer 56 , to prevent output loading . the signal s 2 is injected into the negative terminal of a driven right leg ( drl ) amplifier 58 . in essence , in this approach the drl signal is modulated with square wave information . the drl is responsible for biasing the subject &# 39 ; s body to a reference potential in some eeg systems . the sampling rate for the electrodes 103 can be 1024 samples per second , to ensure an accurate interpretation of the injected signal in the digital domain . because the frequency of the reference signal is far away from the usable eeg band , it permits relatively easy and robust extraction before amplitude detection . in addition the harmonic distortion to the eeg signal from any injected signal is minimal . for each sensor , the amplitude of the measured signal is determined in a narrow frequency band that matches the frequency of the reference signal ( step 214 ). thus , the system effectively measures the amplitude of the injected component at each of the sensors . in one implementation , the amplitude of the square wave reference signal is detected using a derivative / zero - crossing based peak detection algorithm . detected signals are first filtered with a 4th order band pass infinite impulse response ( iir ) filter with a pass band from 270 hz to 276 hz to remove all other frequencies that might affect the accuracy of the algorithm . the peak detection algorithm is then used to detect the amplitude of the square wave . in alternative implementations , low frequency reference signals can be used , allowing for lower overall system sampling rates . in such implementations the amplitude of the injected reference signal should be lowered to keep the harmonic distortion in the eeg signal as low as possible . returning to fig3 b , the measured amplitude is then compared to the amplitude of the original injected reference signal ( step 216 ). the state of contact can then be determined for each electrode based on the comparison ( step 218 ). if the contact is poor , then the measured amplitude will be low compared to the reference signal . in contrast , in the case of good contact , the measured amplitude will be high ( approaching the amplitude of the original injected signal ). in general , if there is no contact , then amplitude of the measured signal will be zero . in particular , the measured amplitude can be normalized by dividing the measured amplitudes by the amplitude of the reference signal . for example , in one implementation the amplitude is divided by 100 uv ( the original amplitude of injected signal ) to generate the normalized value . this normalized amplitude can then be compared to threshold percentages to determine the state of contact of the electrode . for example , a normalized amplitude greater than 0 . 8 can indicate satisfactory contact . this method can be formed quickly and with high reliability to determine contact quality . in addition , each electrode can be assigned one of a multiple of progressively superior contact states based on comparison to associated threshold ranges . for example , each electrode can be assigned one of four or more contact states , e . g ., one of six or more contact states . for example , a normalized amplitude of 0 can indicate no contact , and normalized amplitudes less than 0 . 2 , 0 . 2 to 0 . 4 , 0 . 4 to 0 . 6 , 0 . 6 to 0 . 8 and greater than 0 . 8 can indicate progressively superior contact states , with a normalized amplitude greater than 0 . 8 indicating good or satisfactory contact . the signal quality for each electrode can be displayed to the user , e . g ., on a video display ( step 220 ). for example , the normalized value can be used to drive a color coded map of the users head where various colors represent different levels of sensor contact quality . the user can then reposition or adjust the pressure on the electrodes indicated on the display as having non - satisfactory contact until an acceptable level of contact to is achieved . referring to fig5 , a graphical user interface 60 can be displayed to aid the subject during placement of an electrode headset . the interface 60 includes a simplified schematic illustration 62 of a subject &# 39 ; s head , and an indicator light 64 for each electrode . each indicator light is positioned on the schematic 62 in a position generally equivalent to the position of the associated electrode on the subject &# 39 ; s head when the headset is worn . the color of each indicator light 62 can indicate the contact status of the associated electrode . thus , one of a plurality of predetermined colors can be selected based on the state of contact . in general , red can indicate unacceptable contact , whereas green can indicate acceptable contact . for example , a green light can indicate an acceptable level of contact ( e . g ., a normalized amplitude greater than 0 . 8 as discussed above ), a red light can indicate lack of contact ( e . g ., a normalized amplitude of 0 ), and a yellow light can indicate partial but insufficient contact ( e . g ., a normalized amplitude greater than 0 but less than 0 . 8 ). in addition to determining a state of contact of each sensor , the state of contact of the reference electrodes can also be measured . for example , when the headset is placed on the scalp and all of the sensors have a consistent low reading , it means that the reference signal is not being injected properly and that only a portion of it is getting through . this information can be displayed and the user can be prompted to adjust the reference sensor . similarly if the headset is sitting on the desk , the amplitude of the injected signals will be zero for all sensors . this information can be used to determine that the headset is not in use and can turn the headset off after some time period . in this way battery life can be extended . although fig5 illustrates a circular indicator light , other indicators of the contact status can be used . for example , the indicator can be another simple shape , such a square , triangle or asterisk . in addition , although fig5 illustrates a simplified top - down schematic view of the user &# 39 ; s head , other representations of the user &# 39 ; s scalp can be used . for example , the representation can include one or more side views . in addition , rather than a schematic , the representation can be an actual image of a person &# 39 ; s head , e . g ., the user &# 39 ; s head . as another implementation , a representation of the headset can be displayed rather than a representation of the user &# 39 ; s head . alternatively or in addition , the graphical user interface 60 can include a simplified schematic illustration 72 of a subject &# 39 ; s head , and a numerical indicator 74 of the state of contact . the numerical indicator can be the normalized amplitude measurement . the graphical user interface 60 can also include user editable fields 98 that permit the user to set the thresholds for the various states of contact . returning to fig3 b , before sending the measured biosignals to the state detection engine , the reference signal can be filtered out , leaving only the eeg information ( step 222 ). using the feedback from the display , a user with no training or knowledge of correct application or placement of the electrodes should be able to place the headset properly on the user &# 39 ; s head . due to the use of the reference signal , determination of signal quality is less subject to artifacts or facial expressions and is generally independent of different skin types or other variances across populations , and is thus more reliable . the technique works in real time and can feedback information on signal quality to the user in a clear , concise , intuitive way . in addition , the techniques is safe as the current injected is kept under 10 ua ( existing medical instrumentation limit ). because the frequency of the injected waveform is outside of the conventionally utilized eeg range , it can be easily filtered out . the amplitude of the reference signal can be small enough so that harmonics of the waveform and beats with mains and sampling are below the noise floor . embodiments of the invention and all of the functional operations described in this specification can be implemented in digital electronic circuitry , or in computer software , firmware , or hardware , including the structural means disclosed in this specification and structural equivalents thereof , or in combinations of them . embodiments of the invention can be implemented as one or more computer program products , i . e ., one or more computer programs tangibly embodied in an information carrier , e . g ., in a machine readable storage device or in a propagated signal , for execution by , or to control the operation of , data processing apparatus , e . g ., a programmable processor , a computer , or multiple processors or computers . a computer program ( also known as a program , software , software application , or code ) can be written in any form of programming language , including compiled or interpreted languages , and it can be deployed in any form , including as a stand alone program or as a module , component , subroutine , or other unit suitable for use in a computing environment . a computer program does not necessarily correspond to a file . a program can be stored in a portion of a file that holds other programs or data , in a single file dedicated to the program in question , or in multiple coordinated files ( e . g ., files that store one or more modules , sub programs , or portions of code ). a computer program can be deployed to be executed on one computer or on multiple computers at one site or distributed across multiple sites and interconnected by a communication network . the processes and logic flows described in this specification can be performed by one or more programmable processors executing one or more computer programs to perform functions by operating on input data and generating output . the processes and logic flows can also be performed by , and apparatus can also be implemented as , special purpose logic circuitry , e . g ., an fpga ( field programmable gate array ) or an asic ( application specific integrated circuit ). a number of embodiments of the invention have been described . nevertheless , it will be understood that various modifications may be made without departing from the spirit and scope of the invention . for example , another alternative implementation of the peak detection algorithm is based on a lock - in amplifier . in this implementation , the input signal from each sensor is band pass filtered and then multiplied by the reference signal . the resulting signal is low pass filtered . after some algebraic computation the output value is computed and represents the amplitude of the injected reference component inside of the input signal . the potential advantages of this approach are in lower computational requirements and higher accuracy in the presence of large background noise . accordingly , other embodiments are within the scope of the following claims .
